---
layout: post
title: C++函数重载实现原理浅析
category: 技术
tags: [Pattern]
keywords: C 函数重载
---

## C++函数重载实现原理浅析
C++实现函数重载的技术手段是函数符号改名，所以我们可以通过分析编译器的函数符号改名机制来验证C++函数重载规则。

## 函数重载的概念
函数重载出现在相同作用域中的多个函数，具有相同的名字而形参表不同。
注意：不能仅仅基于不同的返回类型而实现函数重载。返回值是不影响函数签名的。

## 函数调用：
函数调用时会发生什么？学过8086汇编时，我们都知道函数调用是程序执行点跳转到一个符号所在的地方转而执行符号所在地址的代码，然后再跳回去。这个符号就是函数。
我们用一个简单的例子来说明一下函数调用
在这个简单的实例中，我们只是简单的在main函数中调用了一下printhello函数来打印hello world！
```
#include <stdio.h>  
    void printhello()  
    {
       printf("hello world!\n");  
    }  
      
    int main()  
    {  
            printhello();//这里调用函数printhello  
            return 0;  
    } 
```
C语言中函数符号名和对应的函数名是一样的，而C++为了支持函数重载，符号名是在对应的函数名上改编的。如下图所示，函数名为func，而对应的符号名为_Z4funcv。

## 3.C++的函数符号命名规则
在前面的的图示中，我们给出了C++函数编译符号实例，貌似函数名是对应符号的子串额。实际上函数的编译符号是根据函数名，函数的参数表（包括参数类型和数量）相关的。而且不同的编译器的命名规则不一样。只要能保证相同的函数名和不同的函数参数列表生成的符号名不一样就行。下面我们来感受一下GCC的C++编译器的命名规则。
3.1函数返回类型不影响生成的符号名
前面我们说不能仅仅基于不同的返回类型而实现函数重载，原因是函数返回值并不影响最后生成的符号。我现在就验证一下：
我们分别在两个cpp文件中定义两个同名但返回值不同的函数，看一看他们在汇编代码中的符号是否一样。
3.2 函数名，参数列表（参数类型、数目）才是影响符号名的因数
下面我们观察多个参数列表不同的同名函数，看看它们对应的符号名是什么。这次我们不直接观察汇编代码（汇编代码太长了），而是用objdump -t命令直接观察代码对应的目标文件中的符号表。
假设有下面的这些函数（左），以及它们生成符号（右）
![图](\images_zc\upload\C function overloading.png)
看来改编的符号名是在函数名前加了一个前缀，如果没有参数就在后面加一个字母v，如果是int参数就加一个i，如果是char参数就加一个c，float参数就加一个f，double参数加一个d。引用加R，指针加P。貌似我们找到了某种规则。不过不同的规律改编的方法不一样，我们没必要在意某个编译器使用的改名规则。只需要知道函数名+参数列表决定了符号名 就行。也可以看到第二个函数的int返回类型并没对函数的符号名有什么影响。
